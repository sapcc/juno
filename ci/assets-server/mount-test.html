<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Assets Test</title>
    <script
      async
      src="/externals/npm:es-module-shims@1.6.2/dist/es-module-shims.js"
    ></script>
    <script type="esms-options">
      {
        "shimMode": true
      }
    </script>
  </head>
  <body>
    Asset mount test
    <script>
      const params = new URLSearchParams(window.location.search)
      const { name, version, props } = JSON.parse(atob(params.get("config")))
      window.process = { env: { NODE_ENV: "production" } }

      fetch(`/importmap.json`)
        .then((r) => r.json())
        .then((importmap) => {
          importShim.addImportMap(importmap)
          importShim(`@juno/${name}@${version}`).then((app) => {
            const appWrapper = document.createElement("div")
            const mount = app.mount || app.default
            mount(appWrapper, { props })
            document.body.appendChild(appWrapper)
          })
        })
    </script>
  </body>
</html>
